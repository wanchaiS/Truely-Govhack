<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    body {
      width: 350px;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      background: #f8f9fa;
    }
    
    h1 {
      font-size: 22px;
      font-weight: 700;
      margin: 0 0 20px 0;
      color: #1f2937;
      text-align: center;
      letter-spacing: -0.025em;
    }
    
    .setting-section {
      background: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .setting-label {
      font-weight: 500;
      color: #333;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    
    .toggle-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: #0ea5e9;
    }
    
    input:checked + .slider:before {
      transform: translateX(20px);
    }
    
    .status-message {
      font-size: 12px;
      margin-top: 8px;
      padding: 6px 8px;
      border-radius: 4px;
      display: none;
    }
    
    .status-success {
      background: #d1fae5;
      color: #065f46;
    }
    
    .status-error {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .stats-section {
      background: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .stats-header {
      font-weight: 500;
      color: #333;
      margin-bottom: 12px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .stats-icon {
      width: 16px;
      height: 16px;
      background: #22c55e;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: white;
      font-weight: bold;
    }
    
    .stats-numbers {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-number {
      font-size: 18px;
      font-weight: 600;
      color: #22c55e;
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .features-section {
      background: white;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .feature-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px;
      border-radius: 6px;
      margin-bottom: 8px;
      background: #f8fafc;
    }
    
    .feature-item:last-child {
      margin-bottom: 0;
    }
    
    .feature-icon {
      width: 12px;
      height: 12px;
      background: #6366f1;
      border-radius: 2px;
      flex-shrink: 0;
    }
    
    .feature-text {
      font-size: 13px;
      color: #374151;
      font-weight: 500;
    }
    
    .manage-button {
      background: #0ea5e9;
      color: white;
      text-decoration: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      display: inline-block;
      text-align: center;
      font-weight: 500;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    
    .manage-button:hover {
      background: #0284c7;
    }
  </style>
</head>
<body>
  <h1>Truely</h1>
  
  <!-- Stats Section -->
  <div class="stats-section">
    <div class="stats-header">
      <span class="stats-icon">âœ“</span>
      Facts Checked
    </div>
    <div class="stats-numbers">
      <div class="stat-item">
        <div class="stat-number">12</div>
        <div class="stat-label">Today</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">1,247</div>
        <div class="stat-label">Total</div>
      </div>
    </div>
  </div>
  
  <!-- Features Section -->
  <div class="features-section">
    <div class="feature-item">
      <div class="feature-icon"></div>
      <div class="feature-text">Real-time Fact Checking</div>
    </div>
    <div class="feature-item">
      <div class="feature-icon"></div>
      <div class="feature-text">Source Verification</div>
    </div>
  </div>
  
  <div class="setting-section">
    <div class="toggle-section">
      <div class="setting-label">Enable Fact Check</div>
      <label class="toggle-switch">
        <input type="checkbox" id="extensionToggle" checked>
        <span class="slider"></span>
      </label>
    </div>
  </div>
  
  <div class="setting-section">
    <div class="setting-label">Document Management</div>
    <a href="http://localhost/manage" target="_blank" class="manage-button">
      Manage Documents
    </a>
  </div>
  
  <script>
    
    // Add error handler
    window.addEventListener('error', function(e) {
      alert('Script error: ' + e.message);
    });
    
    // Add visual indicator that script is loading
    document.title = 'Truely - Loading...';
    
    // Load saved settings when popup opens
    document.addEventListener('DOMContentLoaded', function() {
      document.title = 'Truely - Ready';
      
      try {
        loadSettings();
        setupEventListeners();
      } catch (error) {
        alert('Initialization error: ' + error.message);
      }
    });
    
    function loadSettings() {
      
      // Try sync storage first, fallback to local storage
      const storage = chrome.storage.sync || chrome.storage.local;
      
      storage.get(['extensionEnabled'], function(data) {
        if (chrome.runtime.lastError) {
          showStatus('Error loading settings', true);
          return;
        }
        
        document.getElementById('extensionToggle').checked = data.extensionEnabled !== false;
      });
    }
    
    function showStatus(message, isError = false) {
      const statusEl = document.getElementById('statusMessage');
      statusEl.textContent = message;
      statusEl.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
      statusEl.style.display = 'block';
      
      setTimeout(() => {
        statusEl.style.display = 'none';
      }, 3000);
    }
    
    function setupEventListeners() {
      
      // Extension toggle
      document.getElementById('extensionToggle').addEventListener('change', function(e) {
        const isEnabled = e.target.checked;
        
        // Try sync storage first, fallback to local storage
        const storage = chrome.storage.sync || chrome.storage.local;
        
        storage.set({ extensionEnabled: isEnabled }, function() {
          if (chrome.runtime.lastError) {
            return;
          }
          
          // Send message to content script to enable/disable
          chrome.tabs.query({active: true, currentWindow: true}, function(tabs) {
            if (tabs[0]) {
              chrome.tabs.sendMessage(tabs[0].id, {
                action: 'toggleExtension',
                enabled: isEnabled
              });
            }
          });
        });
      });
      
      // Landing page link now uses simple href - no JavaScript needed
      
    }
  </script>
</body>
</html>